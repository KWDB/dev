"use strict";(self.webpackChunkkwdb_docs=self.webpackChunkkwdb_docs||[]).push([[673],{2930:(n,e,i)=>{i.d(e,{R:()=>t,x:()=>d});var r=i(9729);const s={},c=r.createContext(s);function t(n){const e=r.useContext(c);return r.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function d(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(s):n.components||s:t(n.components),r.createElement(c.Provider,{value:e},n.children)}},9270:(n,e,i)=>{i.r(e),i.d(e,{assets:()=>l,contentTitle:()=>d,default:()=>h,frontMatter:()=>t,metadata:()=>r,toc:()=>o});const r=JSON.parse('{"id":"quickstart/sample-query","title":"\u4f53\u9a8c\u60a8\u7684\u7b2c\u4e00\u4e2a\u67e5\u8be2","description":"\u4ee5\u4e0b\u662f\u4e00\u4e2a\u7efc\u5408\u5c55\u793a KWDB \u591a\u6a21\u878d\u5408\u80fd\u529b\u7684\u5178\u578b\u67e5\u8be2\uff0c\u5c55\u793a\u4e86\u5982\u4f55\u8de8\u591a\u4e2a\u6a21\u5f0f\uff08\u65f6\u5e8f\u3001\u5173\u7cfb\uff09\u8fdb\u884c\u6570\u636e\u5173\u8054\u548c\u5206\u6790\u3002","source":"@site/docs/quickstart/sample-query.md","sourceDirName":"quickstart","slug":"/quickstart/sample-query","permalink":"/dev/docs/quickstart/sample-query","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"sidebar_position":2},"sidebar":"tutorialSidebar","previous":{"title":"5 \u5206\u949f\u5feb\u901f\u4f53\u9a8c KWDB","permalink":"/dev/docs/quickstart/5M-quick-start"},"next":{"title":"\u7f16\u8bd1 KWDB","permalink":"/dev/docs/compilation"}}');var s=i(5813),c=i(2930);const t={sidebar_position:2},d="\u4f53\u9a8c\u60a8\u7684\u7b2c\u4e00\u4e2a\u67e5\u8be2",l={},o=[{value:"\u521b\u5efa\u6570\u636e\u5e93\u548c\u8868",id:"\u521b\u5efa\u6570\u636e\u5e93\u548c\u8868",level:2},{value:"\u65f6\u5e8f\u6570\u636e\u5e93\u548c\u8868",id:"\u65f6\u5e8f\u6570\u636e\u5e93\u548c\u8868",level:3},{value:"\u5173\u7cfb\u6570\u636e\u5e93\u548c\u8868",id:"\u5173\u7cfb\u6570\u636e\u5e93\u548c\u8868",level:3},{value:"\u63d2\u5165\u6570\u636e",id:"\u63d2\u5165\u6570\u636e",level:2},{value:"\u65f6\u5e8f\u6570\u636e\u63d2\u5165",id:"\u65f6\u5e8f\u6570\u636e\u63d2\u5165",level:3},{value:"\u5173\u7cfb\u6570\u636e\u63d2\u5165",id:"\u5173\u7cfb\u6570\u636e\u63d2\u5165",level:3},{value:"\u6267\u884c\u67e5\u8be2",id:"\u6267\u884c\u67e5\u8be2",level:2},{value:"\u67e5\u8be2\u7ed3\u679c",id:"\u67e5\u8be2\u7ed3\u679c",level:3}];function a(n){const e={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,c.R)(),...n.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(e.header,{children:(0,s.jsx)(e.h1,{id:"\u4f53\u9a8c\u60a8\u7684\u7b2c\u4e00\u4e2a\u67e5\u8be2",children:"\u4f53\u9a8c\u60a8\u7684\u7b2c\u4e00\u4e2a\u67e5\u8be2"})}),"\n",(0,s.jsx)(e.p,{children:"\u4ee5\u4e0b\u662f\u4e00\u4e2a\u7efc\u5408\u5c55\u793a KWDB \u591a\u6a21\u878d\u5408\u80fd\u529b\u7684\u5178\u578b\u67e5\u8be2\uff0c\u5c55\u793a\u4e86\u5982\u4f55\u8de8\u591a\u4e2a\u6a21\u5f0f\uff08\u65f6\u5e8f\u3001\u5173\u7cfb\uff09\u8fdb\u884c\u6570\u636e\u5173\u8054\u548c\u5206\u6790\u3002"}),"\n",(0,s.jsx)(e.h2,{id:"\u521b\u5efa\u6570\u636e\u5e93\u548c\u8868",children:"\u521b\u5efa\u6570\u636e\u5e93\u548c\u8868"}),"\n",(0,s.jsx)(e.h3,{id:"\u65f6\u5e8f\u6570\u636e\u5e93\u548c\u8868",children:"\u65f6\u5e8f\u6570\u636e\u5e93\u548c\u8868"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:["\u521b\u5efa\u4e86\u4e00\u4e2a\u540d\u4e3a ",(0,s.jsx)(e.code,{children:"factory_iot"})," \u7684\u65f6\u5e8f\u6570\u636e\u5e93"]}),"\n",(0,s.jsxs)(e.li,{children:["\u521b\u5efa\u4e86\u65f6\u5e8f\u8868 ",(0,s.jsx)(e.code,{children:"machine_sensors"}),"\uff0c\u5305\u542b\uff1a","\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:["\u65f6\u95f4\u6233\u5b57\u6bb5 ",(0,s.jsx)(e.code,{children:"ts"})," (TIMESTAMPTZ\uff0c\u975e\u7a7a)"]}),"\n",(0,s.jsx)(e.li,{children:"\u4e09\u4e2a\u6d4b\u91cf\u503c\u5b57\u6bb5\uff1a\u632f\u52a8(vibration)\u3001\u6e29\u5ea6(temperature)\u3001\u529f\u8017(power_consumption)"}),"\n",(0,s.jsx)(e.li,{children:"\u4e09\u4e2a\u6807\u7b7e\u5b57\u6bb5\uff1a\u673a\u5668ID(machine_id)\u3001\u751f\u4ea7\u7ebf(production_line)\u3001\u8bbe\u5907\u7c7b\u578b(machine_type)"}),"\n",(0,s.jsxs)(e.li,{children:["\u6307\u5b9a ",(0,s.jsx)(e.code,{children:"machine_id"})," \u4e3a\u4e3b\u6807\u7b7e(PRIMARY TAGS)"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-sql",children:"-- \u521b\u5efa\u65f6\u5e8f\u6570\u636e\u5e93\nCREATE TS DATABASE factory_iot;\n\n-- \u521b\u5efa\u5e26\u6807\u7b7e\u7684\u65f6\u5e8f\u8868\nCREATE TABLE factory_iot.machine_sensors (\n    ts TIMESTAMPTZ NOT NULL,\n    vibration FLOAT,\n    temperature FLOAT,\n    power_consumption FLOAT\n) TAGS (\n    machine_id INT NOT NULL,\n    production_line VARCHAR(50),\n    machine_type VARCHAR(50)\n) PRIMARY TAGS(machine_id);\n"})}),"\n",(0,s.jsx)(e.h3,{id:"\u5173\u7cfb\u6570\u636e\u5e93\u548c\u8868",children:"\u5173\u7cfb\u6570\u636e\u5e93\u548c\u8868"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:["\u521b\u5efa\u4e86\u4e00\u4e2a\u540d\u4e3a ",(0,s.jsx)(e.code,{children:"factory_management"})," \u7684\u5173\u7cfb\u6570\u636e\u5e93"]}),"\n",(0,s.jsxs)(e.li,{children:["\u521b\u5efa\u4e86\u5173\u7cfb\u8868 ",(0,s.jsx)(e.code,{children:"production_orders"}),"\uff0c\u5305\u542b\uff1a","\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"\u8ba2\u5355ID(order_id\uff0c\u4e3b\u952e)"}),"\n",(0,s.jsx)(e.li,{children:"\u673a\u5668ID(machine_id\uff0c\u903b\u8f91\u4e0a\u5f15\u7528\u65f6\u5e8f\u8868\u7684machine_id)"}),"\n",(0,s.jsx)(e.li,{children:"\u4ea7\u54c1\u7f16\u7801(product_code)"}),"\n",(0,s.jsx)(e.li,{children:"\u751f\u4ea7\u8d77\u6b62\u65f6\u95f4(start_time, end_time)"}),"\n",(0,s.jsx)(e.li,{children:"\u8d28\u91cf\u8bc4\u5206(quality_rating)"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-sql",children:"-- \u521b\u5efa\u5173\u7cfb\u6570\u636e\u5e93\nCREATE DATABASE factory_management;\n\n-- \u521b\u5efa\u5173\u7cfb\u8868\nCREATE TABLE factory_management.production_orders (\n    order_id VARCHAR(20) PRIMARY KEY,\n    machine_id INT,  -- \u903b\u8f91\u4e0a\u5f15\u7528machine_sensors.machine_id\n    product_code VARCHAR(20),\n    start_time TIMESTAMPTZ,\n    end_time TIMESTAMPTZ,\n    quality_rating FLOAT\n);\n"})}),"\n",(0,s.jsx)(e.h2,{id:"\u63d2\u5165\u6570\u636e",children:"\u63d2\u5165\u6570\u636e"}),"\n",(0,s.jsx)(e.h3,{id:"\u65f6\u5e8f\u6570\u636e\u63d2\u5165",children:"\u65f6\u5e8f\u6570\u636e\u63d2\u5165"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-sql",children:"-- \u63d2\u5165\u65f6\u5e8f\u6570\u636e\uff08\u8bbe\u5907\u4f20\u611f\u5668\u6570\u636e\uff09\nINSERT INTO factory_iot.machine_sensors VALUES\n('2023-08-01 08:00:00', 2.3, 65.2, 1200, 101, 'LineA', 'CNC'),\n('2023-08-01 09:15:00', 2.5, 66.1, 1250, 101, 'LineA', 'CNC'),\n('2023-08-01 10:30:00', 2.7, 67.0, 1300, 101, 'LineA', 'CNC'),\n('2023-08-01 11:45:00', 2.6, 66.5, 1280, 102, 'LineB', 'CNC'),\n('2023-08-01 13:00:00', 2.8, 67.2, 1320, 102, 'LineB', 'CNC');\n"})}),"\n",(0,s.jsx)(e.h3,{id:"\u5173\u7cfb\u6570\u636e\u63d2\u5165",children:"\u5173\u7cfb\u6570\u636e\u63d2\u5165"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-sql",children:"-- \u63d2\u5165\u5173\u7cfb\u6570\u636e\uff08\u751f\u4ea7\u8ba2\u5355\u6570\u636e\uff09\nINSERT INTO factory_management.production_orders VALUES\n('ORD-2023-101', 101, 'PROD-A100', NOW() - INTERVAL '8 hours', NOW() - INTERVAL '2 hours', 0.98),\n('ORD-2023-102', 101, 'PROD-A200', NOW() - INTERVAL '7 hours 30 minutes', NOW() - INTERVAL '1 hour', 0.95),\n('ORD-2023-103', 102, 'PROD-B100', NOW() - INTERVAL '8 hours', NOW() - INTERVAL '3 hours', 0.92),\n('ORD-2023-104', 102, 'PROD-B200', NOW() - INTERVAL '7 hours', NOW() - INTERVAL '2 hours 30 minutes', 0.90);\n"})}),"\n",(0,s.jsx)(e.h2,{id:"\u6267\u884c\u67e5\u8be2",children:"\u6267\u884c\u67e5\u8be2"}),"\n",(0,s.jsx)(e.p,{children:"\u67e5\u8be2\u5206\u6790\uff1a"}),"\n",(0,s.jsxs)(e.ol,{children:["\n",(0,s.jsxs)(e.li,{children:["\u5173\u8054\u5173\u7cfb\uff1a\u901a\u8fc7 ",(0,s.jsx)(e.code,{children:"machine_id"})," \u5173\u8054\u751f\u4ea7\u8ba2\u5355\u548c\u8bbe\u5907\u4f20\u611f\u5668\u6570\u636e"]}),"\n",(0,s.jsx)(e.li,{children:"\u65f6\u95f4\u8fc7\u6ee4\uff1a\u53ea\u67e5\u8be22023-08-01\u5f53\u5929\u7684\u4f20\u611f\u5668\u6570\u636e"}),"\n",(0,s.jsx)(e.li,{children:"\u805a\u5408\u8ba1\u7b97\uff1a\u8ba1\u7b97\u6bcf\u4e2a\u8ba2\u5355\u671f\u95f4\u8bbe\u5907\u7684\u5e73\u5747\u6e29\u5ea6\u3001\u632f\u52a8\u548c\u529f\u8017"}),"\n",(0,s.jsx)(e.li,{children:"\u5206\u7ec4\uff1a\u6309\u8ba2\u5355\u3001\u4ea7\u54c1\u3001\u8bbe\u5907\u7b49\u7ef4\u5ea6\u5206\u7ec4"}),"\n",(0,s.jsx)(e.li,{children:"\u6392\u5e8f\uff1a\u6309\u8ba2\u5355\u5f00\u59cb\u65f6\u95f4\u964d\u5e8f\u6392\u5217"}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:"\u9884\u671f\u7ed3\u679c\uff1a"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"\u5c55\u793a\u6bcf\u4e2a\u8ba2\u5355\u7684\u57fa\u672c\u4fe1\u606f\u548c\u5bf9\u5e94\u7684\u8bbe\u5907\u8fd0\u884c\u72b6\u6001\u5e73\u5747\u503c"}),"\n",(0,s.jsx)(e.li,{children:"\u53ef\u4ee5\u5206\u6790\u8bbe\u5907\u8fd0\u884c\u53c2\u6570\u4e0e\u4ea7\u54c1\u8d28\u91cf\u7684\u5173\u7cfb"}),"\n",(0,s.jsx)(e.li,{children:"\u53ef\u4ee5\u6bd4\u8f83\u4e0d\u540c\u751f\u4ea7\u7ebf\u6216\u8bbe\u5907\u7c7b\u578b\u7684\u751f\u4ea7\u8868\u73b0"}),"\n"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-sql",children:"-- \u6267\u884c\u8de8\u6a21\u5206\u6790\u67e5\u8be2\nSELECT\n    po.order_id,\n    po.product_code,\n    ms.machine_id,\n    ms.production_line,\n    ms.machine_type,\n    po.start_time,\n    po.end_time,\n    po.quality_rating,\n    AVG(ms.temperature) AS avg_temperature,\n    AVG(ms.vibration) AS avg_vibration,\n    AVG(ms.power_consumption) AS avg_power\nFROM\n    factory_management.production_orders AS po\nJOIN\n    factory_iot.machine_sensors AS ms\n    ON po.machine_id = ms.machine_id\nWHERE\n    ms.ts BETWEEN '2023-08-01 00:00:00' AND '2023-08-02 00:00:00'\nGROUP BY\n    po.order_id,\n    po.product_code,\n    ms.machine_id,\n    ms.production_line,\n    ms.machine_type,\n    po.start_time,\n    po.end_time,\n    po.quality_rating\nORDER BY\n    po.start_time DESC;\n"})}),"\n",(0,s.jsx)(e.h3,{id:"\u67e5\u8be2\u7ed3\u679c",children:"\u67e5\u8be2\u7ed3\u679c"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-sql",children:"    order_id   | product_code | machine_id | production_line | machine_type |            start_time            |             end_time             | quality_rating |  avg_temperature  | avg_vibration | avg_power\n---------------+--------------+------------+-----------------+--------------+----------------------------------+----------------------------------+----------------+-------------------+---------------+------------\n  ORD-2023-104 | PROD-B200    |        102 | LineB           | CNC          | 2025-09-02 01:05:41.060688+00:00 | 2025-09-02 05:35:41.060688+00:00 |            0.9 |             66.85 |           2.7 |      1300\n  ORD-2023-102 | PROD-A200    |        101 | LineA           | CNC          | 2025-09-02 00:35:41.060688+00:00 | 2025-09-02 07:05:41.060688+00:00 |           0.95 | 66.10000000000001 |           2.5 |      1250\n  ORD-2023-101 | PROD-A100    |        101 | LineA           | CNC          | 2025-09-02 00:05:41.060688+00:00 | 2025-09-02 06:05:41.060688+00:00 |           0.98 | 66.10000000000001 |           2.5 |      1250\n  ORD-2023-103 | PROD-B100    |        102 | LineB           | CNC          | 2025-09-02 00:05:41.060688+00:00 | 2025-09-02 05:05:41.060688+00:00 |           0.92 |             66.85 |           2.7 |      1300\n(4 rows)\n\nTime: 15.168875ms\n"})})]})}function h(n={}){const{wrapper:e}={...(0,c.R)(),...n.components};return e?(0,s.jsx)(e,{...n,children:(0,s.jsx)(a,{...n})}):a(n)}}}]);